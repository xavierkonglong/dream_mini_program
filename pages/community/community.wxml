<!--pages/community/community.wxml-->
<view class="container language-{{language}}">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <!-- <view class="header">
    <text class="subtitle">{{i18n.community.subtitle}}</text>
  </view> -->

  <!-- ç­›é€‰ Tabsï¼šæœ€æ–° / ç‚¹èµžæœ€å¤š / æ”¶è—æœ€å¤š -->
  <view class="filter-sticky">
    <van-tabs 
      active="{{activeSort}}" 
      sticky 
      color="#8B5CF6" 
      background="rgba(255,255,255,0.85)" 
      swipeable="{{false}}" 
      bind:change="onChangeSort"
      custom-class="community-tabs"
      nav-class="community-tabs__nav"
      tab-class="community-tabs__tab"
      line-class="community-tabs__line"
    >
      <van-tab title="æœ€æ–°" name="time" />
      <van-tab title="ç‚¹èµžæœ€å¤š" name="like" />
      <van-tab title="æ”¶è—æœ€å¤š" name="favorite" />
    </van-tabs>
  </view>

  <!-- æ¢¦å¢ƒå¸–å­åˆ—è¡¨ -->
  <view class="dream-list">
    <view class="dream-item" wx:for="{{dreamPosts}}" wx:key="postId">
      <!-- è§†é¢‘å¡ç‰‡ -->
      <view bindtap="onViewDream" data-post-id="{{item.postId}}">
        <view class="video-card" wx:if="{{item.videoUrl && item.videoUrl !== ''}}">
          <video class="dream-video" src="{{item.videoUrl}}" controls="{{false}}" show-center-play-btn="{{false}}" show-play-btn="{{false}}" muted="{{true}}" loop="{{true}}" autoplay="{{false}}" poster="{{item.imageUrl || ''}}"></video>
          <view class="video-overlay">
            <van-icon name="play" size="60rpx" class="play-icon" />
          </view>
        </view>

        <!-- æ¢¦å¢ƒå›¾ç‰‡ -->
        <image class="dream-image" src="{{item.imageUrl}}" mode="aspectFill" wx:elif="{{item.imageUrl && item.imageUrl !== ''}}"></image>

        <!-- æ¢¦å¢ƒå†…å®¹ -->
        <view class="dream-content">
          <text class="dream-text">{{item.dreamDescription}}</text>
        </view>
        <!-- å…³é”®è¯æ ‡ç­¾ -->
        <view class="keywords-section" wx:if="{{item.keywords && item.keywords.length > 0}}">
          <view class="keywords">
            <text class="keyword-tag" wx:for="{{item.keywords}}" wx:key="*this" wx:for-item="keyword">{{keyword}}</text>
          </view>
        </view>
      </view>
      <!-- æ“ä½œæŒ‰é’®å’Œç»Ÿè®¡ä¿¡æ¯ -->
      <view class="actions">
        <view class="stats">
          <text class="create-time">{{item.createdAt}}</text>
        </view>

        <view class="action-buttons">
          <view class="action-btn like-btn {{item.isLiked ? 'liked' : ''}}" data-post-id="{{item.postId}}" catchtap="onLike">
            <van-icon size="32rpx" name="{{item.isLiked ? 'like' : 'like-o'}}" class="action-icon {{item.isLiked ? 'liked' : ''}}" />
            <text class="action-text">{{item.likeCount}}</text>
          </view>

          <view class="action-btn favorite-btn {{item.isFavorited ? 'favorited' : ''}}" data-post-id="{{item.postId}}" catchtap="onFavorite">
            <van-icon size="32rpx" name="{{item.isFavorited ? 'star' : 'star-o'}}" class="action-icon {{item.isFavorited ? 'favorited' : ''}}" />
            <text class="action-text">{{item.favoriteCount}}</text>
          </view>
          <van-toast id="van-toast" />
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>{{i18n.community.loading}}</text>
  </view>

  <!-- åŠ è½½æ›´å¤šçŠ¶æ€ -->
  <view class="load-more" wx:if="{{loading && dreamPosts.length > 0}}">
    <text>{{i18n.community.loadingMore}}</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!loading && !hasMore && dreamPosts.length > 0}}">
    <text>{{i18n.community.noMoreContent}}</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && dreamPosts.length === 0}}">
    <text class="empty-icon">ðŸŒ™</text>
    <text class="empty-text">{{i18n.community.emptyTitle}}</text>
    <text class="empty-desc">{{i18n.community.emptyDesc}}</text>
  </view>

  <!-- ç™»å½•å¼¹çª— -->
  <login-modal 
    show="{{showLoginModal}}" 
    title="{{i18n.community.loginTitle}}" 
    subtitle="{{i18n.community.loginSubtitle}}"
    bind:loginSuccess="onLoginSuccess"
    bind:close="onCloseLoginModal"
    bind:loginCancel="onCloseLoginModal"
  />
</view>

<!-- è‡ªå®šä¹‰tabBar -->
<custom-tabbar />